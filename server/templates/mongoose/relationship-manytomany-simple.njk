{# Mongoose Many-to-Many Relationship Template (Simple - No Attributes) #}
{# This template creates simple array references without join collection #}

{# Example: User (many) <-> Role (many) #}
{# In User schema: array of roleIds #}
{# In Role schema: virtual field for users #}

{# Add to "From Model" (e.g., User) schema #}
@Prop({ type: [{ type: Schema.Types.ObjectId, ref: '{{ relationship.toModel }}' }], default: [] })
{{ relationship.fieldName }}: Schema.Types.ObjectId[];

{# Add virtual populate to "To Model" (e.g., Role) schema for reverse lookup #}
// Virtual relationship: Many-to-Many (reverse)
{{ relationship.toModel }}Schema.virtual('{{ relationship.fromModel | lower }}s', {
  ref: '{{ relationship.fromModel }}',
  localField: '_id',
  foreignField: '{{ relationship.fieldName }}',
  justOne: false,
});

// Ensure virtuals are included when converting to JSON
{{ relationship.toModel }}Schema.set('toJSON', { virtuals: true });
{{ relationship.toModel }}Schema.set('toObject', { virtuals: true });
